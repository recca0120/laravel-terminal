(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};!function(e,r,n){var o,i,s;return o=function(){var t,e,r,n;return t=["/","|","\\","-"],n=null,r=50,e=null,{show:function(o){var i;return o.disable(),e=o.get_prompt(),i=0,n=setInterval(function(){return o.set_prompt(t[i++]),i>t.length-1?i=0:void 0},r)},hide:function(t){return clearInterval(n),t.enable(),t.set_prompt(e)}}}(),s=function(){function r(e,r,n){null==e&&(e="white"),null==r&&(r="black"),this.options=null!=n?n:[],this.apply=t(this.apply,this),this.ansi=t(this.ansi,this),this.is=t(this.is,this),this.foreground=this.ansi(e),this.background=this.ansi(r)}return r.prototype.colorList={30:"black",31:"red",32:"green",33:"yellow",34:"blue",35:"magenta",36:"cyan",37:"white",39:"white"},r.prototype.backgroundList={40:"black",41:"red",42:"green",43:"yellow",44:"blue",45:"magenta",46:"cyan",47:"white",49:"black"},r.prototype.colors=e.extend({},e.terminal.ansi_colors.bold,{white:e.terminal.ansi_colors.normal.white,red:e.terminal.ansi_colors.normal.red}),r.prototype.is=function(t,e,r){return null==t&&(t="white"),null==e&&(e="black"),this.options=null!=r?r:[],t===this.foreground&&e===this.background},r.prototype.ansi=function(t){return this.colors[t]?this.colors[t]:t},r.prototype.apply=function(t){return t=e.terminal.escape_brackets(t),"[[;"+this.foreground+";"+this.background+"]"+t+"]"},r}(),i=function(){function r(){this.apply=t(this.apply,this),this.question=t(this.question,this),this.comment=t(this.comment,this),this.info=t(this.info,this),this.error=t(this.error,this)}return r.prototype.formatters={error:new s("white","red"),info:new s("green"),comment:new s("yellow"),question:new s("magenta")},r.prototype.error=function(t){return this.formatters.error.apply(t)},r.prototype.info=function(t){return this.formatters.info.apply(t)},r.prototype.comment=function(t){return this.formatters.comment.apply(t)},r.prototype.question=function(t){return this.formatters.question.apply(t)},r.prototype.apply=function(t,r){var n;return n=new RegExp("(\\033\\[(\\d+)(;\\d+)?m(((?!\\033\\[\\d+).)*)\\033\\[(\\d+)(;\\d+)?m)|(\\[|\\])","g"),t=t.replace(n,function(t){return function(){var r,n;switch(n=arguments,!1){case-1===e.inArray(n[0],["[","]"]):return e.terminal.escape_brackets(n[0]);default:switch(r=e.terminal.escape_brackets(n[4]),!1){case"32"!==n[2]:return t.info(r);case"33"!==n[2]:return t.comment(r);case"37"!==n[2]:return t.error(r);default:return n[0]}}}}(this)),r&&e.each(t.split("\n"),function(t){return function(t,e){return""===e&&(e=" "),r.echo(e)}}(this)),t},r}(),this.Term=function(){function n(n,o){var i;this.element=n,this.options=o,this.onClear=t(this.onClear,this),this.onInit=t(this.onInit,this),this.serverInfo=t(this.serverInfo,this),this.greetings=t(this.greetings,this),this.execute=t(this.execute,this),this.commandVi=t(this.commandVi,this),this.commandArtisan=t(this.commandArtisan,this),this.confirmToProceed=t(this.confirmToProceed,this),this.interpreter=t(this.interpreter,this),this.request=t(this.request,this),this.toBoolean=t(this.toBoolean,this),this.confirm=t(this.confirm,this),this.question=t(this.question,this),this.comment=t(this.comment,this),this.info=t(this.info,this),this.error=t(this.error,this),this.color=t(this.color,this),this.element=e(this.element),this.element.terminal(this.execute,{onInit:this.onInit,onClear:this.onClear,greetings:this.greetings(),prompt:this.prompt}),i=e(r),i.on("resize",function(t){return function(){return t.element.width(t.element.parent().width()),t.element.height(t.element.parent().height())}}(this)),i.trigger("resize")}var s;return n.prototype.ids={},n.prototype.formatter=new i,n.prototype.colors=e.terminal.ansi_colors,n.prototype.term=null,n.prototype.prompt="$ ",n.prototype.color=function(t,e,r){return null==r&&(r="bold"),this.colors[r]&&this.colors[r][t]?this.colors[r][t]:t},n.prototype.error=function(t){return this.formatter.error(t)},n.prototype.info=function(t){return this.formatter.info(t)},n.prototype.comment=function(t){return this.formatter.comment(t)},n.prototype.question=function(t){return this.formatter.question(t)},n.prototype.confirm=function(t,r,n){var o,i;return null==n&&(n=""),o=e.Deferred(),n&&t.echo(" "+n),t.echo(r),i=t.history(),i.disable(),t.push(function(e){return function(r){e.toBoolean(r)?o.resolve(!0):(o.resolve(!1),e.serverInfo()),t.pop(),i.enable()}}(this),{prompt:" > "}),o.promise()},n.prototype.toBoolean=function(t){switch(t.toLowerCase()){case"y":case"yes":return!0;default:return!1}},n.prototype.request=function(t,r){return null==r&&(r=null),this.ids[t.method]=this.ids[t.method]||0,o.show(this.term),e.ajax({url:this.options.endPoint,dataType:"json",type:"post",data:{jsonrpc:"2.0",id:++this.ids[t.method],cmd:t}}).success(function(n){return function(o){return 1===o.error?void n.formatter.apply(o.result,n.term):-1!==e.inArray("-h",t.args)||-1!==e.inArray("--help",t.args)?void n.formatter.apply(o.result,n.term):null!==r?setTimeout(function(){return r(o)},100):n.formatter.apply(o.result,n.term)}}(this)).error(function(t){return function(e,r,n){return t.formatter.error(e.status+": "+n,t.term)}}(this)).complete(function(t){return function(){return o.hide(t.term),t.serverInfo()}}(this))},n.prototype.interpreter=function(t,e){return e||(e=t),this.term.push(function(e){return function(r){return r=r.trim(),r&&e.execute(t.replace(/\s+/g,"-")+" "+r,e.term),!1}}(this),{prompt:e+"> "}),!1},s=function(t){return""+t.charAt(0).toUpperCase()+t.slice(1)},n.prototype.confirmToProceed=function(t,e){return null==e&&(e="Application In Production!"),this.term.echo(this.comment("**************************************")),this.term.echo(this.comment("*     "+e+"     *")),this.term.echo(this.comment("**************************************")),this.term.echo(" "),this.confirm(this.term,this.info("Do you really wish to run this command? [y/N] (yes/no)")+" "+this.comment("[no]")+": ").done(function(e){return function(r){return r===!0?e.request(t):(e.term.echo(" "),e.term.echo(""+e.comment("Command Cancelled!")),e.term.echo(" "))}}(this))},n.prototype.commandArtisan=function(t){var r;return r=e.terminal.parseCommand(t.rest.trim()),"production"===this.options.environment&&-1===e.inArray("--force",r.args)&&-1!==e.inArray(r.name,this.options.confirmToProceed[t.name])?void this.confirmToProceed(t):this.request(t)},n.prototype.commandVi=function(t){var r;return r=t.rest,this.request(t,function(r){return function(n){var o;return r.term.disable(),o=e(r.options.editor),o.html(n.result),vi(o.get(0),{onSave:function(){var e;return e=JSON.stringify(o.val()),t.command+=" --text="+e,t.rest+=" --text="+e,t.args.push("--text="+e),r.request(t)},onExit:function(){return r.term.enable(),r.term.focus()}})}}(this))},n.prototype.execute=function(t,r){var n,o,i,h;switch(t=t.trim()){case"help":case"list":this.formatter.apply(this.options.helpInfo,this.term),this.serverInfo();break;case"":return;default:h=this.options.interpreters;for(o in h)if(i=h[o],t===o)return void this.interpreter(i);n=e.terminal.parseCommand(t.trim()),this["command"+s(n.name)]?this["command"+s(n.name)](n):this.request(n)}},n.prototype.greetings=function(){return[" __                        _    _____              _         _ ","|  |   ___ ___ ___ _ _ ___| |  |_   ____ ___ _____|_|___ ___| |","|  |__| .'|  _| .'| | | -_| |    | || -_|  _|     | |   | .'| |","|_____|__,|_| |__,|\\_/|___|_|    |_||___|_| |_|_|_|_|_|_|__,|_|","","Copyright (c) 2015 Recca Tsai <http://phpwrite.blogspot.tw/>","","Type a command, or type `"+this.info("help")+"`, for a list of commands.",""].join("\n")},n.prototype.serverInfo=function(){var t,e,r;if(!(this.term.level()>1))return t=this.info(this.options.username+"@"+this.options.hostname),e=this.question(""+this.options.os),r=this.comment(""+this.options.basePath),this.term.echo(t+" "+e+" "+r)},n.prototype.onInit=function(t){return this.term=t,this.execute("list",t)},n.prototype.onClear=function(t){return this.serverInfo()},n}()}(jQuery,window,document)}).call(this);